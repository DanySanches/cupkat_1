<form class='form-product-ajax' method='POST' action='{% url "cart:update" %}' data-endpoint='{% url "cart:update" %}' class="form">
  {% csrf_token %}
  <input type='hidden' name='product_id' value='{{ product.id }}' />
  <div class="qtd d-flex align-items-center">
    <label for="quantity" class="me-2">Qtd:</label>
    <input type='number' name='quantity' value='1' min='1' class='form-control' style='width: 60px;' />
  </div>
    {% if in_cart %}
    <button type='submit' class='btn btn-outline-danger btn-sm' style="padding:0px;cursor: pointer;">
      Excluir
    </button>
  {% else %}
    <span class='submit-span'>
      {% if product in cart.products.all %}
    
        <button type='submit' class='btn btn-outline-danger'>Excluir</button>
    
        {% else %}
            <button type='submit' class='btn btn-outline-success btn-sm ms-3'>Adicionar</button>
        
        {% endif %}
    </span>
  {% endif %}
</form>
<script>
document.addEventListener('DOMContentLoaded', function() {
  const forms = document.querySelectorAll('.form-product-ajax');

  forms.forEach(form => {
      form.addEventListener('submit', function(event) {
          event.preventDefault();
          const formData = new FormData(form);
          const endpoint = form.getAttribute('data-endpoint');

          fetch(endpoint, {
              method: 'POST',
              body: formData,
              headers: {
                  'X-Requested-With': 'XMLHttpRequest',
                  'X-CSRFToken': formData.get('csrfmiddlewaretoken')
              }
          })
          .then(response => response.json())
          .then(data => {
              const submitButton = form.querySelector('button[type="submit"]');
              if (data.added) {
                  submitButton.textContent = 'Excluir';
                  submitButton.classList.remove('btn-outline-success');
                  submitButton.classList.add('btn-outline-danger');
                  form.querySelector('input[name="quantity"]').parentElement.remove();
              } else {
                  submitButton.textContent = 'Adicionar';
                  submitButton.classList.remove('btn-outline-danger');
                  submitButton.classList.add('btn-outline-success');
                  const qtdDiv = form.querySelector('.qtd');
                  if (!qtdDiv) {
                      const qtdHTML = '<div class="qtd d-flex align-items-center"><label for="quantity" class="me-2">Qtd:</label><input type="number" id="quantity" name="quantity" value="1" min="1" class="form-control" style="width: 60px;" /></div>';
                      form.insertAdjacentHTML('beforeend', qtdHTML);
                  }
              }
          })
          .catch(error => console.error('Error:', error));
      });
  });
});
</script>